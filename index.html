<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Levantador de Preços para Construção</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f7f7f7;
            border-radius: 10px;
        }
        h2 { text-align: center; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; }
        button { margin-top: 15px; padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        .resultado, .detalhesCategorias { margin-top: 20px; padding: 20px; background-color: #e9ecef; border-radius: 10px; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: white; }
        canvas { margin-top: 30px; }
    </style>
</head>
<body>

<h2>Levantador de Preços para Construção</h2>

<form id="formulario">
    <label>Custo por Metro Quadrado (R$):</label>
    <input type="number" id="custoPorMetroQuadrado" required>
    
    <label>Metros Quadrados:</label>
    <input type="number" id="metrosQuadrados" required>
    
    <label>Custo do Terreno (R$):</label>
    <input type="number" id="custoTerreno" required>
    
    <button type="button" onclick="calcular()">Calcular Total</button>
</form>

<div class="resultado" id="resultado" style="display: none;"></div>

<div id="detalhesCategorias" class="detalhesCategorias" style="display: none;">
    <h3>Adicionar Detalhes para Categoria</h3>
    <label>Selecionar Categoria:</label>
    <select id="categoriaDetalhe">
        <option value="Mobiliário">Mobiliário</option>
        <option value="Paisagismo">Paisagismo</option>
        <option value="Eletrônicos">Eletrônicos</option>
    </select>
    
    <label>Item:</label>
    <input type="text" id="itemDetalhe">
    
    <label>Valor (R$):</label>
    <input type="number" id="valorDetalhe">
    
    <button type="button" onclick="adicionarDetalhe()">Adicionar Item</button>
</div>

<table id="tabelaDetalhes">
    <tr>
        <th>Categoria</th>
        <th>Item</th>
        <th>Valor (R$)</th>
    </tr>
</table>

<canvas id="graficoCategorias" width="400" height="200"></canvas>

<script>
let custos = {};
let detalhes = {};

function calcular() {
    const custoPorMetroQuadrado = parseFloat(document.getElementById("custoPorMetroQuadrado").value);
    const metrosQuadrados = parseFloat(document.getElementById("metrosQuadrados").value);
    const custoTerreno = parseFloat(document.getElementById("custoTerreno").value);
    
    if (isNaN(custoPorMetroQuadrado) || isNaN(metrosQuadrados) || isNaN(custoTerreno)) return;
    
    const custoConstrucao = custoPorMetroQuadrado * metrosQuadrados;
    const custoTotal = custoConstrucao + custoTerreno;
    const precoVenda = custoTotal * 2;
    const impostos = precoVenda * 0.15;
    const lucroLiquido = precoVenda - custoTotal - impostos;
    
    custos = { custoConstrucao, custoTerreno, custoTotal, precoVenda, impostos, lucroLiquido };
    
    mostrarResultados();
    document.getElementById("detalhesCategorias").style.display = "block";
}

function mostrarResultados() {
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.style.display = "block";
    resultadoDiv.innerHTML = `
        <h3>Resultados</h3>
        <p>Custo de Construção: R$ ${custos.custoConstrucao.toFixed(2)}</p>
        <p>Custo do Terreno: R$ ${custos.custoTerreno.toFixed(2)}</p>
        <p>Custo Total: R$ ${custos.custoTotal.toFixed(2)}</p>
        <p>Preço de Venda: R$ ${custos.precoVenda.toFixed(2)}</p>
        <p>Impostos (15%): R$ ${custos.impostos.toFixed(2)}</p>
        <p>Lucro Líquido: R$ ${custos.lucroLiquido.toFixed(2)}</p>
    `;
}

function adicionarDetalhe() {
    const categoria = document.getElementById("categoriaDetalhe").value;
    const item = document.getElementById("itemDetalhe").value;
    const valor = parseFloat(document.getElementById("valorDetalhe").value);
    
    if (!detalhes[categoria]) detalhes[categoria] = [];
    if (item && !isNaN(valor)) {
        detalhes[categoria].push({ item, valor });
        atualizarTabelaDetalhes();
        renderizarGrafico();
    }
}

function atualizarTabelaDetalhes() {
    const tabela = document.getElementById("tabelaDetalhes");
    tabela.innerHTML = `<tr><th>Categoria</th><th>Item</th><th>Valor (R$)</th></tr>`;
    
    Object.keys(detalhes).forEach(categoria => {
        detalhes[categoria].forEach(detalhe => {
            tabela.innerHTML += `<tr><td>${categoria}</td><td>${detalhe.item}</td><td>R$ ${detalhe.valor.toFixed(2)}</td></tr>`;
        });
    });
}

function renderizarGrafico() {
    const ctx = document.getElementById("graficoCategorias").getContext("2d");
    const categorias = Object.keys(detalhes);
    const valores = categorias.map(cat => detalhes[cat].reduce((acc, item) => acc + item.valor, 0));
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categorias,
            datasets: [{
                label: 'Progresso por Categoria (R$)',
                data: valores,
                backgroundColor: '#007bff'
            }]
        },
        options: { responsive: true }
    });
}
</script>

</body>
</html>
