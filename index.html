<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Levantador de Preços para Construção</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f7f7f7;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 { text-align: center; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { margin-top: 20px; width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .resultado { margin-top: 20px; background-color: #e9ecef; padding: 15px; border-radius: 5px; }
        .bloco { background-color: #fff; margin-top: 10px; padding: 10px; border-radius: 5px; border-left: 5px solid #007bff; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: white; }
        canvas { margin-top: 30px; }
    </style>
</head>
<body>

<h2>Levantador de Preços para Construção</h2>

<form id="formulario">
    <label>Custo por Metro Quadrado (R$):</label>
    <input type="number" id="custoPorMetroQuadrado" required>
    
    <label>Metros Quadrados:</label>
    <input type="number" id="metrosQuadrados" required>
    
    <label>Custo do Terreno (R$):</label>
    <input type="number" id="custoTerreno" required>
    
    <label>Categoria:</label>
    <select id="categoria">
        <option value="Desenho">Desenho</option>
        <option value="Mobiliário">Mobiliário</option>
        <option value="Paisagismo">Paisagismo</option>
        <option value="Cercado">Cercado</option>
        <option value="Câmeras">Câmeras</option>
        <option value="Placa Solar">Placa Solar</option>
        <option value="Portão Eletrônico">Portão Eletrônico</option>
        <option value="Divulgação">Divulgação</option>
    </select>
    
    <label>Valor (R$):</label>
    <input type="number" id="valorCategoria">
    
    <button type="button" onclick="adicionarItem()">Adicionar Item</button>
    <button type="button" onclick="calcular()">Calcular Total</button>
</form>

<table id="tabelaItens">
    <tr>
        <th>Categoria</th>
        <th>Valor (R$)</th>
    </tr>
</table>

<div class="resultado" id="resultado"></div>

<div id="detalhesCategorias" style="display: none;">
    <h3>Adicionar Detalhes para Categoria</h3>
    <label>Selecionar Categoria:</label>
    <select id="categoriaDetalhe"></select>
    
    <label>Item:</label>
    <input type="text" id="itemDetalhe">
    
    <label>Valor (R$):</label>
    <input type="number" id="valorDetalhe">
    
    <button type="button" onclick="adicionarDetalhe()">Adicionar Detalhe</button>
</div>

<table id="tabelaDetalhes">
    <tr>
        <th>Categoria</th>
        <th>Item</th>
        <th>Valor (R$)</th>
    </tr>
</table>

<canvas id="graficoCategorias" width="400" height="200"></canvas>

<script>
let itens = [];
let detalhes = {};

function adicionarItem() {
    const categoria = document.getElementById("categoria").value;
    const valor = parseFloat(document.getElementById("valorCategoria").value);
    if (!isNaN(valor) && valor > 0) {
        itens.push({ categoria, valor });
        atualizarTabela();
        preencherCategoriasDetalhe();
    }
}

function atualizarTabela() {
    const tabela = document.getElementById("tabelaItens");
    tabela.innerHTML = `<tr><th>Categoria</th><th>Valor (R$)</th></tr>`;
    itens.forEach(item => {
        tabela.innerHTML += `<tr><td>${item.categoria}</td><td>R$ ${item.valor.toFixed(2)}</td></tr>`;
    });
}

function calcular() {
    document.getElementById("detalhesCategorias").style.display = "block";
    renderizarGrafico();
}

function preencherCategoriasDetalhe() {
    const select = document.getElementById("categoriaDetalhe");
    select.innerHTML = "";
    itens.forEach(item => {
        if (!detalhes[item.categoria]) detalhes[item.categoria] = [];
        const option = document.createElement("option");
        option.value = item.categoria;
        option.textContent = item.categoria;
        select.appendChild(option);
    });
}

function adicionarDetalhe() {
    const categoria = document.getElementById("categoriaDetalhe").value;
    const item = document.getElementById("itemDetalhe").value;
    const valor = parseFloat(document.getElementById("valorDetalhe").value);
    
    if (!isNaN(valor) && item) {
        detalhes[categoria].push({ item, valor });
        atualizarTabelaDetalhes(categoria);
        renderizarGrafico();
    }
}

function atualizarTabelaDetalhes(categoria) {
    const tabela = document.getElementById("tabelaDetalhes");
    tabela.innerHTML = `<tr><th>Categoria</th><th>Item</th><th>Valor (R$)</th></tr>`;
    Object.keys(detalhes).forEach(cat => {
        detalhes[cat].forEach(detalhe => {
            tabela.innerHTML += `<tr><td>${cat}</td><td>${detalhe.item}</td><td>R$ ${detalhe.valor.toFixed(2)}</td></tr>`;
        });
    });
}

function renderizarGrafico() {
    const ctx = document.getElementById("graficoCategorias").getContext("2d");
    const categorias = Object.keys(detalhes);
    const valores = categorias.map(cat => detalhes[cat].reduce((acc, item) => acc + item.valor, 0));

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categorias,
            datasets: [{
                label: 'Progresso por Categoria (R$)',
                data: valores,
                backgroundColor: '#007bff'
            }]
        },
        options: { responsive: true }
    });
}
</script>

</body>
</html>
