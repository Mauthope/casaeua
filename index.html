<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Levantador de Preços para Construção</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f7f7f7;
            border-radius: 10px;
        }
        h2 { text-align: center; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { margin-top: 20px; padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .resultado { margin-top: 20px; background-color: #e9ecef; padding: 15px; }
        .bloco { margin-top: 10px; padding: 10px; background-color: #fff; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #007bff; color: white; }
        #chartContainer { max-width: 800px; margin: 40px auto; }
    </style>
</head>
<body>

<h2>Levantador de Preços para Construção</h2>

<form id="formulario">
    <label>Custo por Metro Quadrado (R$):</label>
    <input type="number" id="custoPorMetroQuadrado" required>
    
    <label>Metros Quadrados:</label>
    <input type="number" id="metrosQuadrados" required>
    
    <label>Custo do Terreno (R$):</label>
    <input type="number" id="custoTerreno" required>
    
    <label>Categoria:</label>
    <select id="categoria">
        <option value="Desenho">Desenho</option>
        <option value="Mobiliário">Mobiliário</option>
        <option value="Paisagismo">Paisagismo</option>
        <option value="Cercado">Cercado</option>
        <option value="Câmeras">Câmeras</option>
        <option value="Placa Solar">Placa Solar</option>
        <option value="Portão Eletrônico">Portão Eletrônico</option>
        <option value="Divulgação">Divulgação</option>
    </select>
    
    <label>Valor (R$):</label>
    <input type="number" id="valorCategoria">
    
    <button type="button" onclick="adicionarItem()">Adicionar Item</button>
    <button type="button" onclick="calcular()">Calcular Total</button>
</form>

<table id="tabelaItens">
    <tr>
        <th>Categoria</th>
        <th>Valor (R$)</th>
    </tr>
</table>

<div class="resultado" id="resultado"></div>

<div id="adicionarDetalhes" style="display: none;">
    <h3>Adicionar Detalhes para Categoria</h3>
    <label>Selecione a Categoria:</label>
    <select id="categoriaDetalhes"></select>
    <label>Nome do Item:</label>
    <input type="text" id="nomeItem">
    <label>Valor do Item (R$):</label>
    <input type="number" id="valorItem">
    <button type="button" onclick="adicionarDetalhe()">Adicionar Detalhe</button>
    <table id="tabelaDetalhes"></table>
</div>

<div id="chartContainer">
    <canvas id="chart"></canvas>
</div>

<script>
let itens = [];
let detalhesPorCategoria = {};

function adicionarItem() {
    const categoria = document.getElementById("categoria").value;
    const valor = parseFloat(document.getElementById("valorCategoria").value);

    if (!isNaN(valor) && valor > 0) {
        itens.push({ categoria, valor });
        atualizarTabela();
    }
}

function atualizarTabela() {
    const tabela = document.getElementById("tabelaItens");
    tabela.innerHTML = '<tr><th>Categoria</th><th>Valor (R$)</th></tr>';
    itens.forEach(item => {
        tabela.innerHTML += `<tr><td>${item.categoria}</td><td>R$ ${item.valor.toFixed(2)}</td></tr>`;
    });

    atualizarOpcoesCategoria();
}

function atualizarOpcoesCategoria() {
    const select = document.getElementById("categoriaDetalhes");
    select.innerHTML = '';
    [...new Set(itens.map(item => item.categoria))].forEach(categoria => {
        select.innerHTML += `<option value="${categoria}">${categoria}</option>`;
    });
}

function calcular() {
    document.getElementById("adicionarDetalhes").style.display = 'block';
    renderizarGrafico();
}

function adicionarDetalhe() {
    const categoria = document.getElementById("categoriaDetalhes").value;
    const nome = document.getElementById("nomeItem").value;
    const valor = parseFloat(document.getElementById("valorItem").value);

    if (!detalhesPorCategoria[categoria]) detalhesPorCategoria[categoria] = [];
    detalhesPorCategoria[categoria].push({ nome, valor });

    atualizarTabelaDetalhes(categoria);
    renderizarGrafico();
}

function atualizarTabelaDetalhes(categoria) {
    const tabela = document.getElementById("tabelaDetalhes");
    tabela.innerHTML = `<tr><th>Item</th><th>Valor (R$)</th></tr>`;
    (detalhesPorCategoria[categoria] || []).forEach(item => {
        tabela.innerHTML += `<tr><td>${item.nome}</td><td>R$ ${item.valor.toFixed(2)}</td></tr>`;
    });
}

function renderizarGrafico() {
    const ctx = document.getElementById("chart").getContext("2d");
    const categorias = Object.keys(detalhesPorCategoria);
    const valores = categorias.map(cat => detalhesPorCategoria[cat].reduce((acc, item) => acc + item.valor, 0));
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categorias,
            datasets: [{
                label: 'Progresso por Categoria',
                data: valores,
                backgroundColor: 'rgba(54, 162, 235, 0.6)'
            }]
        }
    });
}
</script>

</body>
</html>
